{% extends 'core/base.html' %}
{% load widget_tweaks %}
{% load static %}
<style>
    body{
        background-color: #ecf0f1; 
    }
    .card-header {
        width:100%;
        background-color: #f8f9fa;
        border-bottom: 1px solid #ced4da;
        text-align: center;
    }
    .align-left {
        text-align: left;
    }

    .table {
        border-collapse: collapse;
        background-color: beige;
    }

    .table-bordered td,
    .table-bordered th {
        border: 2px solid black; /* Color de las l√≠neas */
    }

    .thead-dark {
        background-color: #343a40; /* Color de fondo para el encabezado */
        color: white; /* Color del texto del encabezado */
    }

    @media (max-width: 680px) {
        .table-responsive {
            overflow-x: auto; /* Permite el desplazamiento en dispositivos peque√±os */
        }
    }
    
</style>
{% block content %}
<main class="px-3" style="position: relative; min-height: 100vh; width: 100%; margin: 0; padding: 0;">
    <style>
        main::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('{% static "core/img/medico_home.jpg" %}') no-repeat center center;
            background-size: cover;
            opacity: 0.2;
            z-index: -1;
        }

        @media (max-width: 768px) {
            .table-responsive {
                overflow-x: auto;
            }
            .card-header {
                padding: 1rem;
                font-size: 1.2rem;
            }
            .table {
                display: block;
            }
            .table thead {
                display: none;
            }
            .table tbody, .table tr, .table td {
                display: block;
                width: 100%;
            }
            .table tr {
                margin-bottom: 1rem;
                border: 1px solid #dee2e6;
                padding: 0.5rem;
                background: white;
                border-radius: 5px;
            }
            .table td {
                text-align: left;
                padding: 0.5rem;
                border-bottom: none;
            }
            .table td::before {
                content: attr(data-label);
                font-weight: bold;
                display: block;
                text-transform: uppercase;
                color: #17a2b8;
            }
        }
    </style>

    <div style="position: relative; z-index: 1;">
        <div class="container mt-5" style="background-color:transparencia; padding: 2rem; border-radius: 10px;">

            <h1 class="text-center fw-bold py-4" 
                <span class="text-primary">Bienvenido,</span> 
                <span class="text-dark">Dr. {{ user.profile.nombre }} {{ user.profile.apellido }}</span> 
                {% if medico %}
                    <span class="text-dark">- Matr√≠cula N¬∞: {{ user.profile.medico.matricula }}</span>
                {% else %}
                    <span class="text-dark">- Matr√≠cula no disponible</span>
                {% endif %}
            </h1>
            

            
                    <div id="search-container" class="bg-white p-4 rounded shadow">
                        <form method="get" action="{% url 'medico_home' %}" class="my-4">
                            {% if messages %}
                                <div class="alert alert-danger mt-3">
                                    {% for message in messages %}
                                        {{ message }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                    
                            <!-- T√≠tulo -->
                            <h3 class="text-info fw-bold text-center py-3" >Buscador de Pacientes</h3>
                    
                            <div class="row">
                                <!-- B√∫squeda por DNI -->
                                <div class="col-md-6">
                                    <label for="search_dni" class="form-label fw-bold text-info">Buscar por DNI</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-primary text-white"><i class="fas fa-id-card"></i></span>
                                        <input 
                                            type="text" 
                                            name="search_dni" 
                                            id="search_dni" 
                                            class="form-control" 
                                            placeholder="Ingrese DNI" 
                                            value="{{ request.GET.search_dni }}"
                                        >
                                        <button type="submit" class="btn btn-primary text-white fw-bold px-4">Buscar</button>
                                    </div>
                                </div>
                    
                                <!-- B√∫squeda por Nombre o Apellido -->
                                <div class="col-md-6">
                                    <label for="search_name" class="form-label fw-bold text-info">Buscar por Nombre o Apellido</label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-primary text-white"><i class="fas fa-user"></i></span>
                                        <input 
                                            type="text" 
                                            name="search_name" 
                                            id="search_name" 
                                            class="form-control" 
                                            placeholder="Ingrese Nombre o Apellido" 
                                            value="{{ request.GET.search_name }}"
                                        >
                                        <button type="submit" class="btn btn-primary text-white fw-bold px-4">Buscar</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    
                        <!-- üîπ Bot√≥n "Refrescar" centrado -->
                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-primary fw-bold px-5" onclick="window.location.href='{% url 'medico_home' %}'">
                                Refrescar
                            </button>
                        </div>
                    </div>
                    
                    
              
        </div>
            


                                        <!-- Tabla de jugadores -->
                            <div class="table-responsive bg-white p-3 rounded shadow">
                                <div class="card-header bg-info text-white text-center p-4 w-100">
                                    <h2 class="mb-0 fw-bold">Lista de Jugadores</h2>
                                </div>
                                <table class="table table-bordered align-middle" >
                                    <thead class="table-light text-center "  >
                                        <tr class="text-center" >
                                            <th scope="col" class="fw-bold" style="font-size: 16px" >Apellido</th>
                                            <th scope="col" class="fw-bold">Nombre</th>
                                            <th scope="col" class="fw-bold">DNI</th>
                                            <th scope="col" class="fw-bold">Estado del Apto</th>
                                            <th scope="col" class="d-none d-lg-table-cell fw-bold">Categor√≠a</th>
                                            <th scope="col" class="d-none d-lg-table-cell fw-bold">Equipo</th>
                                            <th scope="col" class="d-none d-lg-table-cell fw-bold">Torneo</th>
                                            <th scope="col" class="fw-bold">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for jugador in jugadores_info %}
                                            <tr class="text-center jugador-row" data-id="{{ jugador.id }}">
                                                <td>{{ jugador.apellido }}</td>
                                                <td>{{ jugador.nombre }}</td>
                                                <td>{{ jugador.dni }}</td>
                                                <td>{{ jugador.registro_medico_estado|default:"Sin Registro" }}</td>
                                                <td class="d-none d-lg-table-cell">
                                                    {% for categoria_equipo in jugador.categorias_equipo %}
                                                        {{ categoria_equipo.nombre_categoria }}<br>
                                                    {% empty %}
                                                        Sin categor√≠a
                                                    {% endfor %}
                                                </td>
                                                <td class="d-none d-lg-table-cell">
                                                    {% for categoria_equipo in jugador.categorias_equipo %}
                                                        {{ categoria_equipo.nombre_equipo }}<br>
                                                    {% empty %}
                                                        Sin equipo
                                                    {% endfor %}
                                                </td>
                                                <td class="d-none d-lg-table-cell">
                                                    {% for categoria_equipo in jugador.categorias_equipo %}
                                                        {{ categoria_equipo.torneo }}<br>
                                                    {% empty %}
                                                        Sin torneo
                                                    {% endfor %}
                                                </td>
                                                <td>
                                                    <div class="btn-group" role="group" aria-label="Basic example">
                                                        {% if jugador.registro_medico_estado == "PROCESO" %}
                                                            {% if jugador.electrocardiograma_cargado %}
                                                                {% if jugador.edad >= 35 %}
                                                                    {% if jugador.ergonometria_cargado %}
                                                                        <!-- Si el jugador es mayor de 35 y tiene ambos estudios cargados -->
                                                                        <a href="#" class="btn btn-warning me-2 btn-seleccionar" id="cargarFichaBtn" data-id="{{ jugador.id }}">Cargar Ficha</a>
                                                                    {% else %}
                                                                        <!-- Si es mayor de 35 pero falta ergonometr√≠a -->
                                                                        <div class="text-center">
                                                                            <p class="text-danger mb-2">Falta Ergonometr√≠a</p>
                                                                            <a href="#" class="btn btn-warning btn-seleccionar" id="cargarFichaBtn" data-id="{{ jugador.id }}">Cargar Ficha</a>
                                                                        </div>
                                                                    {% endif %}
                                                                {% else %}
                                                                    <!-- Si el jugador es menor de 35 y tiene electrocardiograma cargado -->
                                                                    <a href="#" class="btn btn-warning me-2 btn-seleccionar" id="cargarFichaBtn" data-id="{{ jugador.id }}">Cargar Ficha</a>
                                                                {% endif %}
                                                            {% else %}
                                                                <!-- Si falta el electrocardiograma (indispensable para todos) -->
                                                                <div class="text-center">
                                                                    <p class="text-danger mb-2">Falta Electrocardiograma</p>
                                                                    {% if jugador.edad >= 35 and not jugador.ergonometria_cargado %}
                                                                        <p class="text-danger mb-2">Falta Ergonometr√≠a</p>
                                                                    {% endif %}
                                                                    <a href="#" class="btn btn-warning btn-seleccionar" id="cargarFichaBtn" data-id="{{ jugador.id }}">Cargar Ficha</a>
                                                                </div>
                                                            {% endif %}
                                                        {% elif jugador.registro_medico_estado == "PENDIENTE" %}
                                                            <a href="#" class="btn btn-warning me-2 btn-seleccionar" onclick="toggleSearchMenu()" data-id="{{ jugador.id }}">Modificar</a>
                                                        {% elif jugador.registro_medico_estado == "RECHAZADO" or jugador.registro_medico_estado == "APROBADA" %}
                                                            <div class="d-flex justify-content-center gap-2">
                                                                <a href="{% url 'ficha_medica' jugador.id %}" class="btn btn-success px-4 py-2" target="_blank">Ver</a>
                                                                {% comment %} <a href="{% url 'eliminar_ficha_medica' jugador.id %}" class="btn btn-danger px-4 py-2" 
                                                                onclick="return confirm('¬øEst√°s seguro de que deseas eliminar esta ficha m√©dica?');">Eliminar</a> {% endcomment %}
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                </td>
                                            </tr>
                                        {% empty %}
                                            <tr>
                                                <td colspan="11" class="text-center">No se encontraron resultados.</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        
   
                                        
        {% for jugador in jugadores_info %}                    
                <div class="row jugador-container" id="formularioContainer" data-id="{{ jugador.id }}" style="display: none;">
                        
                                    <!-- Secci√≥n de Antecedentes -->
                                    <div class="container mt-5" id="ficha_medica_section" data-id="{{ jugador.id }}" >  
                                        
                                        
                                        <h2 class="text-center mb-4">Ficha Medica</h2>
                                        
                                        <div id="antecedentes-section"  class="row" >
                                            <div class="col-lg-6 col-md-8 mx-auto">
                                                <div class="card mb-3 player-forms" data-id="{{ jugador.id }}">
                                                    
                                                    <div class="card-header">
                                                        
                                                        <button class="btn btn-secondary w-100 btn-toggle-antecedentes" data-id="{{ jugador.id }}">
                                                            Ver Antecedentes
                                                        </button>
                                                    </div>
                                    
                                                    <div class="card mb-3 player-forms antecedentes-content" id="antecedentes-content-{{ jugador.id }}" style="display: none;">
                                                    <!-- Datos del jugador -->
                                                    
                                                        <div class="mt-4">
                                                                <div class="table-responsive">
                                                                    <table class="table table-bordered text-center" style="border: 2px solid black; background-color: beige;">
                                                        
                                                                        <thead class="thead-dark">
                                                                            
                                                                            <tr>
                                                                                <th class="text-center">Informaci√≥n del Jugador</th>
                                                                                <th class="text-center">Detalles</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                            
                                                                            
                                                                            <tr>
                                                                                <td class="align-left">Nombre</td>
                                                                                <td class="text-center">{{ jugador.nombre }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="align-left">Apellido</td>
                                                                                <td class="text-center">{{ jugador.apellido }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="align-left">Direcci√≥n</td>
                                                                                <td class="text-center">{{ jugador.direccion }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="align-left">Tel√©fono</td>
                                                                                <td class="text-center">{{ jugador.telefono }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="align-left">Grupo Sangu√≠neo</td>
                                                                                <td class="text-center">{{ jugador.grupo_sanguineo }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="align-left">Cobertura M√©dica</td>
                                                                                <td class="text-center">{{ jugador.cobertura_medica }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="align-left">N¬∞ Afiiado</td>
                                                                                <td class="text-center">{{ jugador.numero_afiliado }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="align-left">Torneo</td>
                                                                                <td class="text-center">{{ jugador.categorias_equipo.0.torneo }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="align-left">Categor√≠a</td>
                                                                                <td class="text-center">{{ jugador.categorias_equipo.0.nombre_categoria }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td class="align-left">Equipo</td>
                                                                                <td class="text-center">{{ jugador.categorias_equipo.0.nombre_equipo }}</td>
                                                                            </tr>
                                                            
                                                                        </tbody>
                                                                    </table>
                                                        
                                                                </div>
                                                    
                                                        </div> 
                                                        
                                                        <!--Antecedentes -->
                                                        <div class="table-responsive">
                                                                
                                                                <table class="table table-bordered text-center" style="border: 2px solid black ;">
                                                                    <thead class="thead-dark">
                                                                    
                                                            
                                                                        
                                                                            
                                                                        <tr>
                                                                        
                                                                            <th>Antecedente de Enfermedades</th>
                                                                            <th class="text-center">Respuesta</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        {% for jugador in jugadores_info %}
                                                                            {% for antecedente in jugador.antecedentes %}
                                                                            <tr>
                                                                                
                                                                                <td >¬øFue operado en los ultimos 4 meses?</td>
                                                                                <td class="text-center">{{ antecedente.fue_operado|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td >¬øToma regularmente alguna medicaci√≥n?</td>
                                                                                <td class="text-center">{{ antecedente.toma_medicacion|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td >¬øEstuvo internado en el ultimo a√±o?</td>
                                                                                <td class="text-center">{{ antecedente.estuvo_internado|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                
                                                                                <td>¬øSufre de hormigueos en las manos ?</td>
                                                                                <td class="text-center">{{ antecedente.sufre_hormigueos|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                
                                                                                <td>¬øEs diab√©tico?</td>
                                                                                <td class="text-center">{{ antecedente.es_diabetico|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>¬øEs asm√°tico?</td>
                                                                                <td class="text-center">{{ antecedente.es_asmatico|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td >¬øEs al√©rgico?</td>
                                                                                <td class="text-center">{{ antecedente.es_alergico|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>Observaciones de alergias:</td>
                                                                                <td colspan="2" class="align-left">{{ antecedente.alerg_observ }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td >¬øTiene antecedentes de epilepsia o convulsiones?</td>
                                                                                <td class="text-center">{{ antecedente.antecedente_epilepsia|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                
                                                                                <td>¬øTiene desviasi√≥n de columna?</td>
                                                                                <td class="text-center">{{ antecedente.desviacion_columna|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>¬øTine dolor de cintura despues de realizar ejercicios f√≠sicos ?</td>
                                                                                <td class="text-center">{{ jugador.antecedenteenfermedades.dolor_cintira|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>¬øHa tenido fracturas, luxaciones o lesiones ligamentarias en los √∫ltimos 4 meses?</td>
                                                                                <td class="text-center">{{ jugador.antecedenteenfermedades.fracturas|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                
                                                                                <td>¬øTiene dolores articulares ?</td>
                                                                                <td class="text-center">{{ antecedente.dolores_articulares|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                
                                                                                <td class="align-left">¬ø Alguna vez experiment√≥ excesiva falta de aire mientras realizaba ejercicios f√≠sicos ?</td>
                                                                                <td class="text-center">{{ antecedente.falta_aire|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                
                                                                                <td>¬øHa tenido traumatismos de cr√°neo con p√©rdida del conocimiento en los √∫ltimos 4 meses ?</td>
                                                                                <td class="text-center">{{ jugador.antecedenteenfermedades.tramatismos_craneo|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>¬øAlguna vez sinti√≥ dolor en el pecho mientras realizaba ejercicios f√≠sicos o inmediatamente despu√©s?</td>
                                                                                <td class="text-center">{{ jugador.antecedenteenfermedades.dolor_pecho|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>¬øAlguna vez perdi√≥ el conocimiento mientras realizaba ejercicios f√≠sicos o inmediatamente despu√©s?</td>
                                                                                <td class="text-center">{{ antecedente.perdida_conocimiento|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>¬øLe han detectado alguna vez presi√≥n arterial alta?</td>
                                                                                <td class="text-center">{{ antecedente.presion_arterial|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                
                                                                                <td>¬ø Alguien de la familia ha sufrido una muerte s√∫bita antes de los 45 a√±os?</td>
                                                                                <td class="text-center">{{ antecedente.muerte_subita_familiar|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>¬øAlg√∫n familiar directo tiene alguna enfermedad cardiaca, diagn√≥stico de engrosamiento anormal del coraz√≥n o de S√≠ndrome de Marf√°n?</td>
                                                                                <td class="text-center">{{ antecedente.enfermedad_cardiaca_familiar|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>¬øLe han detectado alguna vez un soplo card√≠aco?</td>
                                                                                <td class="text-center">{{ antecedente.soplo_cardiaco|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>¬øAlg√∫n m√©dico le ha sugerido en alguna oportunidad abstenerse de participar en competiciones atl√©ticas?</td>
                                                                                <td class="text-center">{{ antecedente.abstenerce_competencia|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>¬øAlg√∫n familiar suyo de menos de 65 a√±os (Padres, abuelos, hermanos/as) tiene antecedentes de enfermedad coronaria incluyendo ataques card√≠acos, cirug√≠as de by pass, angioplastia o angina?</td>
                                                                                <td class="text-center">{{ antecedente.antecedentes_coronarios_familiares|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                            
                                                                                <td >¬øFuma, es hipertenso o diab√©tico, tiene colesterol alto?</td>
                                                                                <td class="text-center">{{ antecedente.fumar_hipertension_diabetes|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>Observaciones:</td>
                                                                                <td class="text-center">{{ antecedente.fhd_observacion }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>¬øConsumo de coca√≠na o anab√≥licos?</td>
                                                                                <td class="text-center">{{ antecedente.consumo_cocaina_anabolicos|yesno:"S√≠,No" }}</td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>Observaciones:</td>
                                                                                <td class="text-center" >{{ antecedente.cca_observaciones }}</td>
                                                                            </tr>
                                                                            
                                                                        </tbody>
                                                                        {% endfor %}
                                                                    {% endfor %}
                                                                    
                                                                
                                                                </table>
                                                        </div>
                                                    
                                                    </div>         
                                                </div>   
                                            
                                            </div>
                                        </div>
                                    </div>  
                                    
                <div class="col-lg-6 col-md-8 mx-auto">
                                
                                                        
                                                    
                                <!-- Estudios M√©dicos -->
                                    <div class="card mb-3 player-forms" data-id="{{ jugador.id }}" >
                                        <div class="card-header">
                                            <button class="btn btn-secondary w-100" onclick="toggleForm('estudios-medicos-{{ jugador.id }}')">
                                                Estudios M√©dicos
                                            </button>
                                        </div>
                                        <div id="estudios-medicos-{{ jugador.id }}" class="card-body" 
                                        style="{% if jugador.id|stringformat:"s" == jugador_id %}display: block;{% else %}display: none;{% endif %}">
                                            <!-- Mostrar Estudios Existentes -->
                                            {% for estudio in jugador.estudios_medicos %}
                                            <div class="mb-2">
                                                <strong>Tipo: </strong>{{ estudio.tipo }}
                                                {% if estudio.archivo %}
                                                <a href="{{ estudio.archivo }}" target="_blank" class="btn btn-link">Ver archivo</a>
                                                <!-- Bot√≥n Eliminar -->
                                                <form action="{% url 'registroMedico:eliminar_estudio_medico' estudio.pk %}" method="POST" style="display:inline;">
                                                    {% csrf_token %}
                                                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('¬øSeguro que quieres eliminar este archivo?')">Eliminar</button>
                                                </form>
                                                {% else %}
                                                <span class="text-danger">No cargado</span>
                                                {% endif %}
                                                <p><strong>Observaciones:</strong> {{ estudio.observaciones|default:"Sin observaciones" }}</p>
                                            </div>
                                            {% endfor %}
                                            {% if not jugador.estudios_medicos %}
                                            <p>No hay estudios m√©dicos cargados.</p>
                                            {% endif %}
                                            <h3 class="text-center">Cargar Estudios</h3>
                                            <!-- Formulario para Cargar Nuevos Estudios -->
                                            <form ="cargarEstudioForm_{{ jugador.id }}" method="POST" enctype="multipart/form-data" >
                                                {% csrf_token %}
                                                <!-- Campo oculto para el ID del Jugador -->
                                                <input type="hidden" name="jugador_id" value="{{ jugador.id }}">
                                                <div class="mb-3">
                                                    <label for="tipo_{{ jugador.id }}" class="form-label">Tipo de Estudio</label>
                                                    <select id="tipo_{{ jugador.id }}" name="tipo_estudio" class="form-select" required>
                                                        <option value="" disabled selected>Seleccionar Tipo</option>
                                                        <option value="ORINA">An√°lisis de Orina</option>
                                                        <option value="ELECTRO">Electrocardiograma</option>
                                                        <option value="ERGOMETRIA">Ergometr√≠a</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="archivo_{{ jugador.id }}" class="form-label">Archivo</label>
                                                    <input type="file" id="archivo_{{ jugador.id }}" name="archivo" class="form-control" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="observaciones_{{ jugador.id }}" class="form-label">Observaciones</label>
                                                    <textarea id="observaciones_{{ jugador.id }}" name="observaciones" class="form-control"></textarea>
                                                </div>
                                                <div class="d-flex justify-content-end">
                                                    <button type="submit" class="btn btn-primary w-20">Cargar Estudio M√©dico</button>
                                                </div>
                                            
                                            </form>
                                        </div>
                                    </div>

    
                                    <!-- Electro Basal -->
                                    <div class="card mb-3 player-forms" data-id="{{ jugador.id }}">
                                        <div class="card-header">
                                            <button class="btn btn-secondary w-100" onclick="toggleForm('electro-basal-form-{{ jugador.id }}')">Electro Basal</button>
                                        </div>
                                        <div id="electro-basal-form-{{ jugador.id }}" {% if form_saved %}style="display:none;"{% endif %}>
                                            <div class="card-body">
                                                <form method="POST" class="ajax-form" action="{% url 'electro_basal_view' jugador.id %}">
                                                    {% csrf_token %}
                                            

                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{jugador.electro_basal_form.ritmo.id_for_label }}">Ritmo:</label>
                                                                {{ jugador.electro_basal_form.ritmo }}
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.electro_basal_form.PQ.id_for_label }}">PQ:</label>
                                                                {{ jugador.electro_basal_form.PQ }}
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.electro_basal_form.frecuencia.id_for_label }}">Frecuencia:</label>
                                                                {{ jugador.electro_basal_form.frecuencia }}
                                                            </div>
                                                        </div>
                                                    </div>
                                    
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.electro_basal_form.arritmias.id_for_label }}">Arritmias:</label>
                                                                {{ jugador.electro_basal_form.arritmias }}
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.electro_basal_form.ejeQRS.id_for_label }}">EjeQRS:</label>
                                                                {{ jugador.electro_basal_form.ejeQRS }}
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.electro_basal_form.trazadoNormal.id_for_label }}">Trazado Normal:</label>
                                                                {{ jugador.electro_basal_form.trazadoNormal }}
                                                            </div>
                                                        </div>
                                                    </div>
                                    
                                                    <div class="mb-3">
                                                        <label for="{{ jugador.electro_basal_form.observaciones.id_for_label }}">Observaciones:</label>
                                                        {{ jugador.electro_basal_form.observaciones }}
                                                    </div>
                                    
                                                    <div class="d-flex justify-content-end">
                                                        <button type="submit" class="btn btn-primary w-20">Guardar</button>
                                            
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    

                           



                                    
                                <!-- Electro Esfuerzo -->
                                    <div class="card mb-3 player-forms" data-id="{{ jugador.id }}" >
                                        <div class="card-header">
                                            <button class="btn btn-secondary w-100" onclick="toggleForm('electro_esfuerzo_form-{{ jugador.id }}')">Electro Esfuerzo</button>
                                        </div>
                                        <div id="electro_esfuerzo_form-{{ jugador.id }}" class="collapse" style="display:none;">
                                            <div class="card-body">
                                                <form method="POST" class="ajax-form" action="{% url 'electro_esfuerzo_view' jugador.id %}">
                                                    {% csrf_token %}
                                                    {{ jugador.electro_esfuerzo_form.as_p }}
                                                    <div class="d-flex justify-content-end">
                                                        <button type="submit" class="btn btn-primary w-20">Guardar</button>
                                                    </div>  
                                                </form>
                                            </div>
                                        </div>
                                    </div>

                                
                                
                                
                                <!-- Cardiovascular -->
                                    <div class="card mb-3 player-forms" data-id="{{ jugador.id }}">
                                        <div class="card-header">
                                            <button class="btn btn-secondary w-100" onclick="toggleForm('cardiovascular_form-{{ jugador.id }}')">Cardiovascular</button>
                                        </div>
                                        <div id="cardiovascular_form-{{ jugador.id }}" class="collapse" style="display:none;">
                                            <div class="card-body">
                                                <form method="POST" class="ajax-form" action="{% url 'cardiovascular_view' jugador.id %}">
                                                    {% csrf_token %}

                                                    <!-- Contenedor para los primeros 3 campos (izquierda) -->
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.cardiovascular_form.auscultacion.id_for_label }}" class="form-label">{{ jugador.cardiovascular_form.auscultacion.label }}</label>
                                                                {{ jugador.cardiovascular_form.auscultacion }}
                                                                {% if jugador.cardiovascular_form.auscultacion.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.cardiovascular_form.auscultacion.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.cardiovascular_form.auscultacion.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>

                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.cardiovascular_form.R1.id_for_label }}" class="form-label">{{ jugador.cardiovascular_form.R1.label }}</label>
                                                                {{ jugador.cardiovascular_form.R1 }}
                                                                {% if jugador.cardiovascular_form.R1.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.cardiovascular_form.R1.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.cardiovascular_form.R1.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>

                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.cardiovascular_form.R2.id_for_label }}" class="form-label">{{ jugador.cardiovascular_form.R2.label }}</label>
                                                                {{ jugador.cardiovascular_form.R2 }}
                                                                {% if jugador.cardiovascular_form.R2.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.cardiovascular_form.R2.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.cardiovascular_form.R2.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Contenedor para los otros 3 campos (derecha) -->
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.cardiovascular_form.soplos.id_for_label }}" class="form-label">{{ jugador.cardiovascular_form.soplos.label }}</label>
                                                                {{ jugador.cardiovascular_form.soplos }}
                                                                {% if jugador.cardiovascular_form.soplos.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.cardiovascular_form.soplos.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.cardiovascular_form.soplos.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>

                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.cardiovascular_form.tension_arterial.id_for_label }}" class="form-label">{{ jugador.cardiovascular_form.tension_arterial.label }}</label>
                                                                {{ jugador.cardiovascular_form.tension_arterial }}
                                                                {% if jugador.cardiovascular_form.tension_arterial.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.cardiovascular_form.tension_arterial.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.cardiovascular_form.tension_arterial.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>

                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.cardiovascular_form.ruidos_agregados.id_for_label }}" class="form-label">{{ jugador.cardiovascular_form.ruidos_agregados.label }}</label>
                                                                {{ jugador.cardiovascular_form.ruidos_agregados }}
                                                                {% if jugador.cardiovascular_form.ruidos_agregados.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.cardiovascular_form.ruidos_agregados.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.cardiovascular_form.ruidos_agregados.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Campo 'observaciones' (en una fila completa debajo) -->
                                                    <div class="mb-3">
                                                        <label for="{{ jugador.cardiovascular_form.observaciones.id_for_label }}" class="form-label">{{ jugador.cardiovascular_form.observaciones.label }}</label>
                                                        {{ jugador.cardiovascular_form.observaciones }}
                                                        {% if jugador.cardiovascular_form.observaciones.help_text %}
                                                            <small class="form-text text-muted">{{ jugador.cardiovascular_form.observaciones.help_text }}</small>
                                                        {% endif %}
                                                        {% for error in jugador.cardiovascular_form.observaciones.errors %}
                                                            <div class="text-danger">{{ error }}</div>
                                                        {% endfor %}
                                                    </div>

                                                    <!-- Bot√≥n de submit -->
                                                    <div class="d-flex justify-content-end">
                                                        <button type="submit" class="btn btn-primary w-20">Guardar</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>



                            
                                    
                                
                                <!-- Laboratorio -->
                                    <div class="card mb-3 player-forms" data-id="{{ jugador.id }}">
                                        <div class="card-header">
                                            <button class="btn btn-secondary w-100" onclick="toggleForm('laboratorio_form-{{ jugador.id }}')">Laboratorio</button>
                                        </div>
                                        <div id="laboratorio_form-{{ jugador.id }}" class="collapse" style="display:none;">
                                            <div class="card-body">
                                                <form method="POST" class="ajax-form" action="{% url 'laboratorio_view' jugador.id %}">
                                                    {% csrf_token %}

                                                    <!-- Contenedor para los campos a la izquierda (Uremia, Glucemia, Otros) -->
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.laboratorio_form.uremia.id_for_label }}" class="form-label">{{ jugador.laboratorio_form.uremia.label }}</label>
                                                                {{ jugador.laboratorio_form.uremia }}
                                                                {% if jugador.laboratorio_form.uremia.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.laboratorio_form.uremia.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.laboratorio_form.uremia.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>

                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.laboratorio_form.glucemia.id_for_label }}" class="form-label">{{ jugador.laboratorio_form.glucemia.label }}</label>
                                                                {{ jugador.laboratorio_form.glucemia }}
                                                                {% if jugador.laboratorio_form.glucemia.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.laboratorio_form.glucemia.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.laboratorio_form.glucemia.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>

                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.laboratorio_form.otros.id_for_label }}" class="form-label">{{ jugador.laboratorio_form.otros.label }}</label>
                                                                {{ jugador.laboratorio_form.otros }}
                                                                {% if jugador.laboratorio_form.otros.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.laboratorio_form.otros.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.laboratorio_form.otros.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Contenedor para los campos a la derecha (Citol√≥gico, Orina, Colesterol) -->
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.laboratorio_form.citologico.id_for_label }}" class="form-label">{{ jugador.laboratorio_form.citologico.label }}</label>
                                                                {{ jugador.laboratorio_form.citologico }}
                                                                {% if jugador.laboratorio_form.citologico.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.laboratorio_form.citologico.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.laboratorio_form.citologico.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>

                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.laboratorio_form.orina.id_for_label }}" class="form-label">{{ jugador.laboratorio_form.orina.label }}</label>
                                                                {{ jugador.laboratorio_form.orina }}
                                                                {% if jugador.laboratorio_form.orina.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.laboratorio_form.orina.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.laboratorio_form.orina.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>

                                                        <div class="col-md-4">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.laboratorio_form.colesterol.id_for_label }}" class="form-label">{{ jugador.laboratorio_form.colesterol.label }}</label>
                                                                {{ jugador.laboratorio_form.colesterol }}
                                                                {% if jugador.laboratorio_form.colesterol.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.laboratorio_form.colesterol.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.laboratorio_form.colesterol.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Bot√≥n de submit -->
                                                    <div class="d-flex justify-content-end">
                                                        <button type="submit" class="btn btn-primary w-20">Guardar</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>


                            
                                
                                    <!-- T√≥rax -->
                                    <div class="card mb-3 player-forms" data-id="{{ jugador.id }}" >
                                        <div class="card-header">
                                            <button class="btn btn-secondary w-100" onclick="toggleForm('torax_form-{{ jugador.id }}')">T√≥rax</button>
                                        </div>
                                        <div id="torax_form-{{ jugador.id }}" class="collapse" style="display:none;">
                                            <div class="card-body">
                                                <form method="POST" class="ajax-form" action="{% url 'torax_view' jugador.id %}">
                                                    {% csrf_token %}
                                                    {{ jugador.torax_form.as_p }}
                                                    <div class="d-flex justify-content-end">
                                                        <button type="submit" class="btn btn-primary w-20">Guardar</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>

                            
                                    
                                <!-- Oftalmol√≥gico -->
                                    <div class="card mb-3 player-forms" data-id="{{ jugador.id }}">
                                        <div class="card-header">
                                            <button class="btn btn-secondary w-100" onclick="toggleForm('oftalmologico_form-{{ jugador.id }}')">Oftalmol√≥gico</button>
                                        </div>
                                        <div id="oftalmologico_form-{{ jugador.id }}" class="collapse" style="display:none;">
                                            <div class="card-body">
                                                <form method="POST" class="ajax-form" action="{% url 'oftalmologico_view' jugador.id %}">
                                                    {% csrf_token %}

                                                    <!-- Contenedor para los campos (OD a la derecha y OI a la izquierda) -->
                                                    <div class="row">
                                                        <!-- Ojo Izquierdo (OI) a la izquierda -->
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.oftalmologico_form.oi.id_for_label }}" class="form-label">{{ jugador.oftalmologico_form.oi.label }}</label>
                                                                {{ jugador.oftalmologico_form.oi }}
                                                                {% if jugador.oftalmologico_form.oi.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.oftalmologico_form.oi.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.oftalmologico_form.oi.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>

                                                        <!-- Ojo Derecho (OD) a la derecha -->
                                                        <div class="col-md-6">
                                                            <div class="mb-3">
                                                                <label for="{{ jugador.oftalmologico_form.od.id_for_label }}" class="form-label">{{ jugador.oftalmologico_form.od.label }}</label>
                                                                {{ jugador.oftalmologico_form.od }}
                                                                {% if jugador.oftalmologico_form.od.help_text %}
                                                                    <small class="form-text text-muted">{{ jugador.oftalmologico_form.od.help_text }}</small>
                                                                {% endif %}
                                                                {% for error in jugador.oftalmologico_form.od.errors %}
                                                                    <div class="text-danger">{{ error }}</div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Bot√≥n de submit -->
                                                    <div class="d-flex justify-content-end">
                                                        <button type="submit" class="btn btn-primary w-20">Guardar</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>


                                
                                
                                    <!-- Otros Ex√°menes Cl√≠nicos -->
                                <!-- Otros Ex√°menes Cl√≠nicos -->
                                    <div class="card mb-3 player-forms" data-id="{{ jugador.id }}" >
                                        <div class="card-header">
                                            <button class="btn btn-secondary w-100" onclick="toggleForm('otros_examenes_clinicos_form-{{ jugador.id }}')">Otros Ex√°menes Cl√≠nicos</button>
                                        </div>
                                        <div id="otros_examenes_clinicos_form-{{ jugador.id }}" class="collapse" style="display:none;">
                                            <div class="card-body">
                                                <form method="POST" class="ajax-form" action="{% url 'otros_examenes_clinicos_view' jugador.id %}">
                                                    {% csrf_token %}
                                                    {{ jugador.otros_examenes_form.as_p }}
                                                    <div class="d-flex justify-content-end">
                                                        <button type="submit" class="btn btn-primary w-20">Guardar</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Aprobaci√≥n del M√©dico  -->
                                        
                                <!-- Certificado M√©dico -->
                                <div class="card mb-3 player-forms" data-id="{{ jugador.id }}" >
                                    <div class="card-header">
                                        <button class="btn btn-secondary w-100" onclick="toggleForm('certificadoMedico-{{ jugador.id }}')">Certificado M√©dico</button>
                                    </div>
                                    <form method="post" action="{% url 'registro_medico_update_view' jugador.id %}">
                                        {% csrf_token %}
                                        <div class="card-body">
                                            <div id="certificadoMedico-{{ jugador.id }}" class="card-body" style="display:none;">
                                                <p>Habiendo tomado conocimiento de los "Antecedentes de Enfermedad" consignados en el anverso, realizados los estudios citados precedentemente y efectuada la evaluaci√≥n cl√≠nico/m√©dica correspondiente al Sr/Sra:</p>
                                                <p><strong>Nombre:</strong> {{ jugador.nombre }} - {{ jugador.apellido }}</p>
                                                {{ jugador.fichaMedica }}
                                                <p><strong>Edad:</strong> {{ jugador.edad }}</p>
                                                <p><strong>DNI:</strong> {{ jugador.dni }}</p>
                                                <p>Declaro lo siguiente:</p>

                                                <!-- Estado -->
                                                <div class="form-group">
                                                    <label for="estado">Estado:</label>
                                                    <select class="form-control" id="estado" name="estado" onchange="toggleFields()">
                                                        <option value="APROBADA" {% if registro.estado == "APROBADA" %}selected{% endif %}>APROBADA</option>
                                                        <option value="RECHAZADA" {% if registro.estado == "RECHAZADA" %}selected{% endif %}>RECHAZADA</option>
                                                        <option value="PENDIENTE" {% if registro.estado == "PENDIENTE" %}selected{% endif %}>PENDIENTE</option>
                                                    </select>
                                                </div>

                                                <!-- Fecha de Creaci√≥n (Fecha de Llenado) -->
                                                <div class="form-group" id="fecha_de_llenado_div" >
                                                    <label for="fecha_de_llenado">Fecha de Llenado:</label>
                                                    <input type="date" class="form-control" id="fecha_de_llenado" name="fecha_de_llenado" 
                                                        {% if registro.fecha_de_llenado %}
                                                            value="{{ registro.fecha_de_llenado|date:"Y-m-d" }}"
                                                        {% else %}
                                                            value=""
                                                        {% endif %}
                                                    >
                                                </div>

                                                <!-- Fecha de Caducidad -->
                                                <div class="form-group" id="fecha_caducidad_div" >
                                                    <label for="fecha_caducidad">Fecha de Caducidad:</label>
                                                    <input type="date" class="form-control" id="fecha_caducidad" name="fecha_caducidad" 
                                                        {% if registro.fecha_caducidad %}
                                                            value="{{ registro.fecha_caducidad|date:"Y-m-d" }}"
                                                        {% else %}
                                                            value=""
                                                        {% endif %}
                                                    >
                                                </div>

                                                <!-- Observaciones -->
                                                <div class="form-group" id="observacion_div" style="display:none;">
                                                    <label for="observaciones">Observaciones:</label>
                                                    <input type="text" class="form-control" id="observacion" name="observacion" 
                                                        {% if registro.observacion %}
                                                            value="{{ registro.observacion }}"
                                                        {% else %}
                                                            value=""
                                                        {% endif %}
                                                    >
                                                </div>

                                                <p>Firma y sello del M√©dico:</p>
                                                <div class="form-group">
                                                    <label for="firma">Firma:</label>
                                                    <input type="text" class="form-control" id="firma" name="firma" value="{{ user.profile.nombre }} {{ user.profile.apellido }}" readonly>
                                                </div>

                                                <p>Esta certificaci√≥n tiene validez por el a√±o en curso a partir de la fecha de emisi√≥n y es v√°lida sin enmiendas s√≥lo en original.</p>
                                            </div>
                                        </div>

                                        <!-- Bot√≥n para guardar cambios -->
                                        <!-- Verificaci√≥n de requisitos -->
                              <!-- Verificaci√≥n de requisitos antes de habilitar el bot√≥n -->
                                    {% if jugador.electrocardiograma_cargado %}
                                    {% if jugador.edad >= 35 %}
                                        {% if jugador.ergonometria_cargado %}
                                            <!-- Si tiene todos los requisitos, habilitar bot√≥n -->
                                            <div class="d-flex justify-content-center mt-3">
                                                <button type="submit" id="guardarFichaBtn" class="btn btn-primary w-50" disabled>Guardar</button>
                                            </div>
                                        {% else %}
                                            <!-- Si falta ergonometr√≠a -->
                                            <div class="text-center mt-3">
                                                <p class="text-danger">Falta Ergonometr√≠a</p>
                                            </div>
                                        {% endif %}
                                    {% else %}
                                        <!-- Si es menor de 35 y solo necesita electrocardiograma -->
                                        <div class="d-flex justify-content-center mt-3">
                                            <button type="submit" id="guardarFichaBtn" class="btn btn-primary w-50" disabled>Guardar</button>
                                        </div>
                                    {% endif %}
                                    {% else %}
                                    <!-- Si falta el electrocardiograma -->
                                    <div class="text-center mt-3">
                                        <p class="text-danger">Falta Electrocardiograma</p>
                                        {% if jugador.edad >= 35 and not jugador.ergonometria_cargado %}
                                            <p class="text-danger">Falta Ergonometr√≠a</p>
                                        {% endif %}
                                    </div>
                                    {% endif %}


                                    </form>
                                </div>

                            
                                <div class="container text-center mt-5">
                                    <button onclick="location.href='{% url 'medico_home' %}'" class="btn btn-primary">Volver a Inicio</button>
                                </div>
                        </div>
                    </div>
            
            

                </div>

        {% endfor %}
    </div>
</main>
<script>
    

    // Set the default date to today's date for the "Fecha de Llenado" field
    document.addEventListener('DOMContentLoaded', function() {
        const fechaDeLlenado = document.getElementById('fecha_de_llenado');
        if (fechaDeLlenado && !fechaDeLlenado.value) {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            fechaDeLlenado.value = `${yyyy}-${mm}-${dd}`;
        }
    });
</script>

<script>
    
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".btn-seleccionar").forEach(function (boton) {
                boton.addEventListener("click", function (event) {
                    event.preventDefault();
    
                    let jugadorId = this.getAttribute("data-id");
    
                    if (!jugadorId) {
                        console.error("‚ö†Ô∏è Error: No se encontr√≥ el ID del jugador.");
                        return;
                    }
    
                    console.log("Jugador seleccionado con ID:", jugadorId);
    
                    // Ocultar todas las filas de jugadores excepto la seleccionada
                    document.querySelectorAll(".jugador-row").forEach(function (fila) {
                        if (fila.getAttribute("data-id") !== jugadorId) {
                            fila.style.display = "none";
                        } else {
                            fila.style.display = "table-row";
                        }
                    });
    
                    // üîπ Mostrar los formularios del jugador seleccionado
                    document.querySelectorAll(".jugador-container").forEach(function (formContainer) {
                        if (formContainer.getAttribute("data-id") === jugadorId) {
                            formContainer.style.display = "block";  
                        } else {
                            formContainer.style.display = "none";
                        }
                    });
    
                    console.log("‚úÖ Mostrando solo los formularios del jugador con ID:", jugadorId);
    
                    // üîπ Asegurar que el formulario de antecedentes permanezca CERRADO por defecto
                    let antecedentesForm = document.getElementById(`antecedentes-content-${jugadorId}`);
    
                    if (antecedentesForm) {
                        antecedentesForm.style.display = "none"; 
                        console.log("üîπ El formulario de antecedentes se mantiene cerrado.");
                    } else {
                        console.warn("‚ö†Ô∏è No se encontr√≥ el formulario de antecedentes para el jugador con ID:", jugadorId);
                    }
                });
            });
    
            // üîπ Permitir que el usuario despliegue/cierre el formulario de antecedentes manualmente
            document.querySelectorAll(".btn-toggle-antecedentes").forEach(function (boton) {
                boton.addEventListener("click", function (event) {
                    event.preventDefault();
    
                    let jugadorId = this.getAttribute("data-id");
                    let antecedentesForm = document.getElementById(`antecedentes-content-${jugadorId}`);
    
                    if (antecedentesForm) {
                        if (antecedentesForm.style.display === "none" || antecedentesForm.style.display === "") {
                            antecedentesForm.style.display = "block";
                            console.log("‚úÖ Mostrando formulario de antecedentes para el jugador con ID:", jugadorId);
                        } else {
                            antecedentesForm.style.display = "none";
                            console.log("‚ùå Ocultando formulario de antecedentes para el jugador con ID:", jugadorId);
                        }
                    } else {
                        console.warn("‚ö†Ô∏è No se encontr√≥ el formulario de antecedentes para el jugador con ID:", jugadorId);
                    }
                });
            });
        });
  
    

    // üîπ Funci√≥n para abrir/cerrar formularios espec√≠ficos dentro del jugador seleccionado
    function toggleForm(formId) {
        let form = document.getElementById(formId);
        if (form.style.display === "none" || form.style.display === "") {
            form.style.display = "block";
        } else {
            form.style.display = "none";
        }
    }

</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        function verificarFormularios() {
            let formularios = document.querySelectorAll(".ajax-form");
            let botonGuardar = document.getElementById("guardarFichaBtn");
            let todosCompletos = true;
    
            formularios.forEach(formulario => {
                // Excluir el formulario de Certificado M√©dico (por ID o Clase)
                if (formulario.id === "certificadoMedicoForm") {
                    return; // Salta este formulario
                }
    
                let inputs = formulario.querySelectorAll("input, select, textarea");
                inputs.forEach(input => {
                    if (input.hasAttribute("required") && input.value.trim() === "") {
                        todosCompletos = false;
                    }
                });
            });
    
            // Habilitar el bot√≥n si todos los formularios est√°n completos
            botonGuardar.disabled = !todosCompletos;
        }
    
        // Escuchar eventos en todos los formularios
        let formularios = document.querySelectorAll(".ajax-form");
        formularios.forEach(formulario => {
            formulario.addEventListener("input", verificarFormularios);
        });
    
        // Verificaci√≥n inicial
        verificarFormularios();
    });
    document.addEventListener("DOMContentLoaded", function () {
        const params = new URLSearchParams(window.location.search);
        const jugadorId = params.get("jugador_id");

        if (jugadorId) {
            const formSection = document.getElementById(`estudios-medicos-${jugadorId}`);
            if (formSection) {
                formSection.style.display = "block"; // Mostrar el formulario
            }
        }
    });
</script>
{% endblock %}
