{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<style>
    .card-body {
        background-color: #f0f0f0;
    }
    header {
        display: none !important;
    }
    .form-section-title {
        font-weight: bold;
        font-size: 1.25rem;
        background-color: #e9ecef;
        padding: 12px;
        border-bottom: 1px solid #dee2e6;
        border-top-left-radius: .25rem;
        border-top-right-radius: .25rem;
        text-align: center;
    }
</style>

<section id="content">
    <div class="container mt-5">
        <h1 class="text-center mb-4">Certificado Único de Salud (CUS)</h1>

        <!-- Información del estudiante -->
        <div class="card mb-4">
            <div class="card-header">
                <h2>1 - INFORMACIÓN PERSONAL</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 text-center">
                        <p>Nombre: <strong>{{ estudiante.nombre }}</strong></p>
                        <p>Apellido: <strong>{{ estudiante.apellido }}</strong></p>
                        <p>DNI: <strong>{{ estudiante.dni }}</strong></p>
                        <p>Fecha de nacimiento: <strong>{{ estudiante.fecha_nacimiento }}</strong></p>
                        <p>Edad: <strong>{{ estudiante.edad }}</strong></p>
                    </div>
                    <div class="col-md-6 text-center">
                        <p>Padre/Madre/Tutor: <strong>{{ tutor }}</strong></p>
                        <p>Fecha de llenado: <strong>{{ cus.fecha_de_llenado }}</strong></p>
                        <p>Fecha de vencimiento: <strong>{{ cus.fecha_caducidad }}</strong></p>
                        <p>Estado: <strong>{{ cus.estado }}</strong></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Antecedentes -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header text-center bg-light">
                <h4 class="mb-0">Antecedentes</h4>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">1. Vacunaciones</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Carnet:</strong> {{ antecedentes.carnet_vacunacion|yesno:"Sí,No" }}</p>
                                <p><strong>Esquema completo:</strong> {{ antecedentes.esquema_completo|yesno:"Sí,No" }}</p>
                                <p><strong>Debe completar esquema con:</strong> {{ antecedentes.esquema_faltante|default:"-" }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">4. Medicamentos Prescriptos</h5>
                            </div>
                            <div class="card-body">
                                <p>{{ antecedentes.medicamentos_prescriptos }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">2. Antecedentes Patológicos</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Enfermedades importantes:</strong> {{ antecedentes.enfermedades_importantes }}</p>
                                <p><strong>Cirugías:</strong> {{ antecedentes.cirugias }}</p>
                                <p><strong>Cardiovasculares:</strong> {{ antecedentes.cardiovasculares }}</p>
                                <p><strong>Trauma funcional:</strong> {{ antecedentes.trauma_funcional }}</p>
                                <p><strong>Alergias:</strong> {{ antecedentes.alergias }}</p>
                                <p><strong>Oftalmológicos:</strong> {{ antecedentes.oftalmologicos }}</p>
                                <p><strong>Auditivos:</strong> {{ antecedentes.auditivos }}</p>
                                <p><strong>Diabetes:</strong> {{ antecedentes.diabetes|yesno:"Sí,No" }}</p>
                                <p><strong>Asma:</strong> {{ antecedentes.asma|yesno:"Sí,No" }}</p>
                                <p><strong>Chagas:</strong> {{ antecedentes.chagas|yesno:"Sí,No" }}</p>
                                <p><strong>Hipertensión:</strong> {{ antecedentes.hipertension|yesno:"Sí,No" }}</p>
                                <p><strong>Neurológico:</strong> {{ antecedentes.neurologico|yesno:"Sí,No" }}</p>
                                <p><strong>Otras:</strong> {{ antecedentes.otras }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">5. Durante Actividad Física Previa Sufrió</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Cansancio extremo:</strong> {{ antecedentes.cansancio_extremo|yesno:"Sí,No" }}</p>
                                <p><strong>Falta de aire:</strong> {{ antecedentes.falta_aire|yesno:"Sí,No" }}</p>
                                <p><strong>Pérdida de conocimiento:</strong> {{ antecedentes.perdida_conocimiento|yesno:"Sí,No" }}</p>
                                <p><strong>Palpitaciones:</strong> {{ antecedentes.palpitaciones|yesno:"Sí,No" }}</p>
                                <p><strong>Precordialgias:</strong> {{ antecedentes.precordialgias|yesno:"Sí,No" }}</p>
                                <p><strong>Cefaleas:</strong> {{ antecedentes.cefaleas|yesno:"Sí,No" }}</p>
                                <p><strong>Vómitos:</strong> {{ antecedentes.vomitos|yesno:"Sí,No" }}</p>
                                <p><strong>Otros síntomas:</strong> {{ antecedentes.otros }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">3. Condiciones de Riesgo</h5>
                            </div>
                            <div class="card-body">
                                <p>{{ antecedentes.condiciones_riesgo }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">6. Declaración Jurada</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Firmó declaración jurada:</strong> {{ antecedentes.declaracion_jurada|yesno:"Sí,No" }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Exámenes Médicos -->
        <div class="card mb-4">
            <div class="card-header text-center">
                <h2>Exámenes Médicos</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Columna izquierda -->
                    <div class="col-md-6">
                        <!-- Examen Físico -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Examen Fisico</h5>
                            </div>
                           
                            <div class="card-body">
                                <p><strong>Peso:</strong> {{ examen_fisico_form.instance.peso|default:"-" }}</p>
                                <p><strong>Talla:</strong> {{ examen_fisico_form.instance.talla|default:"-" }}</p>
                                <p><strong>IMC:</strong> {{ examen_fisico_form.instance.imc|default:"-" }}</p>
                                <p><strong>Observaciones:</strong> {{ examen_fisico_form.instance.observaciones|default:"-" }}</p>
                            </div>
                        </div>

                        <!-- Alimentación -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Alimentacion y Nutricion</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Solicita plan especial:</strong> {{ alimentacion_form.instance.solicita_plan_especial|yesno:"Sí,No" }}</p>
                                <p><strong>Tipo de plan:</strong> {{ alimentacion_form.instance.tipo_plan|default:"-" }}</p>
                            </div>
                        </div>

                        <!-- Oftalmológico -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Examen Oftalmologico</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Agudeza visual OD:</strong> {{ oftalmologico_form.instance.agudeza_visual_der|default:"-" }}</p>
                                <p><strong>Agudeza visual OI:</strong> {{ oftalmologico_form.instance.agudeza_visual_izq|default:"-" }}</p>
                                <p><strong>Usa anteojos:</strong> {{ oftalmologico_form.instance.usa_anteojos|yesno:"Sí,No" }}</p>
                                <p><strong>Otros:</strong> {{ oftalmologico_form.instance.otros|default:"-" }}</p>
                            </div>
                        </div>

                        <!-- Fonoaudiológico -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Examen Fonoaudiologo</h5>
                            </div>
                            <div class="card-body">
                                <p>{{ fono_form.instance.detalles|default:"-" }}</p>
                            </div>
                        </div>

                        <!-- Piel -->
                        <div class="card mb-3 shadow-sm">
                              <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Examen de Piel y T.C.S.C.</h5>
                            </div>
                            <div class="card-body">
                                <p>{{ piel_form.instance.detalles|default:"-" }}</p>
                            </div>
                        </div>

                        <!-- Odontológico -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Examen Odontologico</h5>
                            </div>
                            <div class="card-body">
                                <p>{{ odonto_form.instance.detalles|default:"-" }}</p>
                            </div>
                        </div>

                        <!-- Cardiovascular -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Examen Cardiovascular</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Auscultación:</strong> {{ cardio_form.instance.auscultacion|default:"-" }}</p>
                                <p><strong>Arritmia:</strong> {{ cardio_form.instance.arritmia|default:"-" }}</p>
                                <p><strong>Soplos:</strong> {{ cardio_form.instance.soplos|default:"-" }}</p>
                                <p><strong>Presión arterial:</strong> {{ cardio_form.instance.tension_arterial|default:"-" }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Columna derecha -->
                    <div class="col-md-6">
                        <!-- Respiratorio -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Examen Respiratorio</h5>
                            </div>
                            <div class="card-body">
                                <p>{{ respiratorio_form.instance.detalles|default:"-" }}</p>
                            </div>
                        </div>

                        <!-- Abdomen -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Examen Abdomen.</h5>
                            </div>
                            <div class="card-body">
                                <p>{{ abdomen_form.instance.detalles|default:"-" }}</p>
                            </div>
                        </div>

                        <!-- Genitourinario -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Examen Genitourinario</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Menarca:</strong> {{ genito_form.instance.menarca|yesno:"Sí,No" }}</p>
                                <p><strong>Turner:</strong> {{ genito_form.instance.turner|yesno:"Sí,No" }}</p>
                            </div>
                        </div>

                        <!-- Endocrinológico -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Examen Endrocrinológico</h5>
                            </div>
                            <div class="card-body">
                                <p>{{ endocrino_form.instance.detalles|default:"-" }}</p>
                            </div>
                        </div>

                        <!-- Osteoarticular -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Examen Osteoarticular</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Columna normal:</strong> {{ osteo_form.instance.columna_normal|yesno:"Sí,No" }}</p>
                                <p><strong>Cifosis:</strong> {{ osteo_form.instance.cifosis|yesno:"Sí,No" }}</p>
                                <p><strong>Lordosis:</strong> {{ osteo_form.instance.lordosis|yesno:"Sí,No" }}</p>
                                <p><strong>Escoliosis:</strong> {{ osteo_form.instance.escoliosis|yesno:"Sí,No" }}</p>
                                <p><strong>Miembros superiores:</strong> {{ osteo_form.instance.miembros_superiores|default:"-" }}</p>
                                <p><strong>Miembros inferiores:</strong> {{ osteo_form.instance.miembros_inferiores|default:"-" }}</p>
                            </div>
                        </div>

                        <!-- Neurológico -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Examen Neurologico</h5>
                            </div>
                            <div class="card-body">
                                <p>{{ neuro_form.instance.detalles|default:"-" }}</p>
                            </div>
                        </div>

                        <!-- Comentario / Derivación -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Comentario / Derivación</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Comentarios y/o derivaciones:</strong> {{ comentario_form.instance.comentarios_derivaciones|default:"-" }}</p>
                                <p><strong>Se recomienda:</strong> {{ comentario_form.instance.recomendaciones|default:"-" }}</p>
                            </div>
                        </div>

                        <!-- Recomendaciones -->
                        <div class="card mb-3 shadow-sm">
                            <div class="card-header bg-white">
                                <h5 class="mb-0 text-center">Recomendaciones</h5>
                            </div>
                            <div class="card-body">
                                <p>{{ recomendaciones_form.instance.detalles|default:"-" }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

       
        <!-- Firma del Médico -->
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-white">
                <h2 class="mb-0 text-center">Certificado Médico</h2>
            </div>
            <div class="card-body">
                <p><strong>Estado:</strong> {{ cus.estado }}</p>
                <p><strong>Fecha de emisión:</strong> {{ cus.fecha_de_llenado|date:"d/m/Y" }}</p>
                <p><strong>Fecha de vencimiento:</strong> {{ cus.fecha_caducidad|date:"d/m/Y" }}</p>
        
                <p class="mt-4">
                    Hago constar que <strong>{{ estudiante.apellido }} {{ estudiante.nombre }}</strong> se encuentra en condiciones para el ingreso escolar, la realización de actividades físicas curriculares y lo establecido en la Resolución M.E. 57 de acuerdo al examen clínico actual y en reposo practicado en la fecha.
                </p>
        
                <p class="fw-bold mt-3">
                    ESTA DOCUMENTACIÓN ORIGINAL DEBE PERMANECER EN CUSTODIA Y CONSERVACIÓN LEGAL DE LA DIRECCIÓN DEL CENTRO EDUCATIVO, Y LA COPIA EN PODER DEL RESPONSABLE LEGAL DEL ALUMNO.
                </p>
        
                <hr>
        
                <div class="bg-white p-3 mt-4 rounded text-center">
                    <h5 class="text-center">Médico responsable</h5>
                    <p><strong>Nombre:</strong> {{ cus.medico.profile.nombre }} {{ cus.medico.profile.apellido }}</p>
                    <p><strong>Matrícula:</strong> {{ cus.medico.matricula }}</p>
                    <p><strong>Email:</strong> {{ cus.medico.profile.email }}</p>
                
                    {% if cus.medico.firma %}
                        <p><strong>Firma:</strong></p>
                        <img src="{{ cus.medico.firma.url }}" alt="Firma del médico" class="img-fluid" style="max-width: 150px;">
                    {% else %}
                        <p>No se ha proporcionado una firma.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        

        <!-- Botones -->
        <div class="mt-4 d-flex flex-column flex-md-row justify-content-end align-items-stretch gap-2">
            <form method="get"
                action="{% if perfil.rol == 'medico' %}{% url 'cus_home' %}
                        {% elif perfil.rol == 'estudiante' %}{% url 'menu_estudiante' %}
                        {% elif perfil.rol == 'colegio' %}{% url 'colegio_home' %}

              
                        {% else %}{% url 'home' %}{% endif %}">
                        <button type="submit" class="btn btn-secondary w-100" style="min-width: 120px;">Volver</button>
            </form>
        
            <form method="get">
                <input type="hidden" name="descargar_pdf" value="true">
                <button type="submit" class="btn btn-primary w-100" style="min-width: 120px;">Descargar</button>
            </form>
        </div>
        
        
    </div>
</section>
{% endblock %}